<!DOCTYPE html>
<html lang="cn">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
		<meta name="description" content="Web site created using create-react-app" />
		<link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
		<script src="./wasm_exec.js"></script>
		<script>
			WebAssembly.instantiateStreaming = async (resp, importObject) => {
				const source = await (await resp).arrayBuffer();
				console.log('source', source);
				return await WebAssembly.instantiate(source, importObject);
			};
			// 容纳 WebAssembly 模块的容器
			var go = new Go();
			var request = Object.assign(new XMLHttpRequest(),{
				responseType: 'arraybuffer', //配置数据返回类型
				onload: loaded,
			});
			request.open('GET', 'test001.wasm', true); 
			request.send();
			async function loaded(){
				var promise01 = new Promise(rsv=>{
					rsv({
						arrayBuffer: function(){
							return new Promise(rsv02=>rsv02(request.response));
						},
					});
				});
				let result = await WebAssembly.instantiateStreaming(
					promise01,
					go.importObject,
				);
				console.log('result', result);
				go.run(result.instance);
				// go.run(result.instance);
				// WebAssembly.instantiate(
				//     request.response,
				//     go.importObject,
				// ).then(results => {
				//     // results.instance.exports.exported_func();
				//     console.log('results', results);
				// });
			}
			// 下载 WebAssembly 模块并执行模块
			// 也就是运行 Go 代码里面的 main 函数
			// 这样 fib 函数就注册进了 Javascript 全局环境
			// function callFib() {
			//     let paramInput = document.getElementById("param")
			//     let n = parseInt(paramInput.value || "0")
			//     // 传入输入参数和回调函数
			//     // 回调函数负责呈现结果
			//     fib(n, function(result) {
			//             var resultDom = document.getElementById("result")
			//             resultDom.value = result
			//     });
			// }
		</script>
		<title>听写工具</title>
	</head>
	<body>
		<h1>123</h1>
	</body>
</html>
